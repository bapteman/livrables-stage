(()=>{const e="print-audio-above-view",t="print-audio-below-view",n=e=>{const t={...e,user_agent:navigator.userAgent,canonical_url:J,collection_id:H,referer:M,session_id:x},n=document.createElement("img");n.src="https://t.360.dev.audion.fm/v2/event?"+Object.entries(t).map(([e,t])=>null!==t&&""!==t?`${e}=${encodeURIComponent(t)}`:null).filter(e=>null!==e).join("&"),n.className="print-audio-pixelImg",T.append(n)},a=e=>I[e]||e,r=()=>{A.addEventListener("durationchange",()=>{B.forEach(e=>e.classList.replace("print-audio-loading","print-audio-app-ready"))}),(e=>{const t="https://dev-player.360.audion.fm/v3/latest";T.dataset.printAudioId=e.id,T.dataset.title=e.displayTitle,T.dataset.url=e.contentUrl,T.dataset.sessionId=x,T.dataset.markers=JSON.stringify(e.markers||[]);{const e=document.createElement("link");e.rel="stylesheet",e.href=t+"/static/css/main.css",T.append(e);const n=document.createElement("script");n.src=t+"/static/js/main.js",T.append(n)}})(C)},i=()=>{A.removeEventListener("ended",i),r()},o=()=>{B.forEach(e=>e.classList.remove("print-audio-processing")),A.addEventListener("ended",i),A.src="https://dev-player.360.audion.fm/v3/latest/static/media/jingle.wav"},s=()=>{A.removeEventListener("ended",s),P=!0,C?o():S=setTimeout(()=>{A.currentTime=0,A.play(),A.addEventListener("ended",s)},4e3)},d=()=>{U||(A.addEventListener("ended",s),U=!0,B.forEach(e=>e.classList.add("print-audio-waiting","print-audio-processing")),A.src="https://dev-player.360.audion.fm/v3/latest/static/media"+a("wait"))},l=e=>Boolean(e&&"DONE"===e.status&&e.displayTitle&&e.contentUrl),c=e=>e.hasOwnProperty("error")||"ERROR"===e.status,u=async()=>{const e={method:"POST",body:JSON.stringify({canonicalUrl:J,collectionId:H}),headers:new Headers({"Content-Type":"application/json"})};try{const t=await fetch("https://dev-printaudio.360.audion.fm/public/printAudios",e).then(e=>{if(!e.ok)throw e.status;return e.json()});return{id:t.id,status:t.status,contentUrl:t.mediaUrl,displayTitle:t.title,markers:t.markers}}catch(e){return{error:e}}},p=e=>{A.paused||(B.forEach(e=>e.classList.add("print-audio-loading","print-audio-started")),n({event_type:"player_start",event_value_string:`${"click"!==e.type?"autoplay:":""}${e.type}`}),(async({fn:e,validate:t,shouldAbort:n,beforeRetry:a,interval:r})=>{const i=async(o,s)=>{const d=await e();return t(d)?o(d):n(d)?s(new Error("Abort polling")):(a(),void setTimeout(i,r,o,s))};return new Promise(i)})({fn:u,validate:l,shouldAbort:c,beforeRetry:d,interval:1e3}).then(e=>{C=e,U?P&&(A.removeEventListener("ended",s),clearTimeout(S),o()):r()}).catch(e=>{B.forEach(e=>e.classList.remove("print-audio-loading"))}))},m=e=>{if(A.paused){const t=A.play();A.autoplay=!0,t.then(e=>{O=!0,(R||"scroll"===k)&&window.removeEventListener("scroll",E),"visible"===k&&window.removeEventListener("scroll",f),"hover"===k&&B.forEach(e=>e.removeEventListener("mouseover",y))}).catch(()=>{}),p(e)}},y=e=>{O||m(e)},v=(n,a)=>{const{isIntersecting:r,boundingClientRect:i,intersectionRect:o}=n[0];r?(B.forEach(n=>n.classList.remove(e,t)),j=!0):(i.top<o.top?B.forEach(n=>{n.classList.add(e),n.classList.remove(t)}):B.forEach(n=>{n.classList.add(t),n.classList.remove(e)}),j=!1)},E=e=>{++$>1&&y(e)},f=e=>{j&&E(e)};let h=!1,L=null,w=!1;const g=()=>{h?(h=!1,B.forEach(e=>e.classList.remove("print-audio-active"))):w=!0,document.removeEventListener("pointerup",g)},b=()=>{L=null,h=!0,w&&(g(),w=!1)},_=()=>{B.forEach(e=>e.classList.add("print-audio-active")),L||(L=setTimeout(b,125)),document.addEventListener("pointerup",g)},T=document.getElementById("audion-360-print-audio-player");let I={};(()=>{const e=T.dataset.dictionary&&JSON.parse(T.dataset.dictionary)||{};I={listen_to_this_article:"Ecouter cet article",ad:"Annonce",your_content_after_this_ad:"Votre contenu aprÃ¨s cette annonce",powered_by:"Powered by",wait:"/wait.fr.mp3",...e}})(),(()=>{const e=Array.from(document.getElementsByClassName("audion-360-print-audio-player-tag")),t=Array.from(document.getElementsByClassName("audion-360-print-audio-player-titleText")),n=Array.from(document.getElementsByClassName("audion-360-print-audio-player-poweredBy")),r=T.dataset.label||a("listen_to_this_article"),i=document.querySelector(T.dataset.title),o=i&&i.innerText||"",s=a("powered_by");e.forEach(e=>e.innerHTML=r),t.forEach(e=>e.innerHTML=o),n.forEach(e=>e.prepend(s))})();const B=[document.getElementById("audion-360-print-audio-player-body-thin"),document.getElementById("audion-360-print-audio-player-body-sticky"),document.getElementById("audion-360-print-audio-player-body-float")].filter(e=>null!==e),A=document.getElementById("audion-360-print-audio-player-audio"),N=Array.from(document.getElementsByClassName("audion-360-print-audio-player-btn"));let O=!1;const k=T.dataset.autoPlay,R="true"===T.dataset.scrollToPlay;let j=!1,C=null,U=!1,P=!1,S=null,$=0;(()=>{N.forEach(e=>{e.addEventListener("pointerup",m),e.addEventListener("pointerdown",_)}),(R||"scroll"===k)&&window.addEventListener("scroll",E),"visible"===k&&window.addEventListener("scroll",f),"hover"===k&&B.forEach(e=>e.addEventListener("mouseover",y));const e=document.getElementById("audion-360-print-audio-player-body-thin");if(e){new IntersectionObserver(v).observe(e)}window.addEventListener("beforeunload",(function(){n({event_type:"session_end"})}))})(),B.forEach(e=>e.classList.add("print-audio-ready"));const x=T.dataset.sessionId,H=T.dataset.id,J=T.dataset.canonicalUrl,M=T.dataset.referer;n({event_type:"session_start"})})();